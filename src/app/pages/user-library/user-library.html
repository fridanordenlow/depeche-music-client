<div class="library-container">
  <div class="library-header-wrapper">
    <mat-icon>library_music</mat-icon>
    <!-- <img src="dm-icon.svg" alt="Depeche Music icon" /> -->
    <h1>My Library</h1>
  </div>
  @if (currentUser(); as user) {
  <div class="user-greeting">
    <div>
      <h2>
        Welcome, <span>{{ user.username }}</span
        >!
      </h2>
      <p>
        See your collection of artist, albums and tracks below. Continue building your library by
        exploring new releases, user recommendations and search for music. There are three
        categories you can use to add music to your library:
      </p>
    </div>
    <div class="icon-legend">
      <span><mat-icon>favorite</mat-icon> Your favorite music</span>
      <span><mat-icon>explore</mat-icon> Music you wish to explore</span>
      <span><mat-icon>check_circle</mat-icon> Already discovered</span>
    </div>
  </div>
  }

  <mat-tab-group animationDuration="0ms">
    <mat-tab label="Tracks">
      @if (tracks().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">
          @if (status === 'love') { <mat-icon>favorite</mat-icon> } @else if (status === 'explore')
          { <mat-icon>explore</mat-icon> } @else { <mat-icon>check_circle</mat-icon> }
          {{ statusTitles[status] }}
        </h2>

        @let filteredTracks = getItemsByStatus(tracks(), status); @if (filteredTracks.length > 0) {
        <mat-action-list>
          @for (item of filteredTracks; track item._id) {
          <mat-list-item [routerLink]="['/details', item.itemType, item.spotifyItemId]">
            <img matListItemAvatar [src]="item.metadata.imageUrl || ''" alt="Album cover" />
            <span matListItemTitle>{{ item.metadata.title }}</span>
            <span matListItemLine>{{ item.metadata.artists?.[0]?.name }}</span>
            <div matListItemMeta>
              <button
                mat-icon-button
                (click)="deleteItem(item._id); $event.stopPropagation()"
                type="button"
                class="delete-button"
              >
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </mat-list-item>
          <mat-divider></mat-divider>
          }
        </mat-action-list>
        } @else {
        <p class="empty-category-text">No tracks in this category yet.</p>
        }
      </section>
      } } @else if (!isLoading()) {
      <div class="empty-state">
        <mat-icon>music_off</mat-icon>
        <p>No tracks found in your library.</p>
      </div>
      }
    </mat-tab>

    <mat-tab label="Albums">
      @if (albums().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">
          @if (status === 'love') { <mat-icon>favorite</mat-icon> } @else if (status === 'explore')
          { <mat-icon>explore</mat-icon> } @else { <mat-icon>check_circle</mat-icon> }
          {{ statusTitles[status] }}
        </h2>
        @let filteredAlbums = getItemsByStatus(albums(), status); @if (filteredAlbums.length > 0) {
        <div class="simple-grid">
          @for (item of filteredAlbums; track item._id) {
          <div class="grid-item" [routerLink]="['/details', item.itemType, item.spotifyItemId]">
            <img [src]="item.metadata.imageUrl || ''" alt="Album cover" />
            <div class="grid-info">
              <p class="album-title">{{ item.metadata.title }}</p>
              <p class="album-artist">{{ item.metadata.artists?.[0]?.name }}</p>
            </div>
            <button
              mat-icon-button
              (click)="deleteItem(item._id); $event.stopPropagation()"
              [aria-label]="'Delete ' + item.metadata.title + ' from library'"
              type="button"
              class="delete-button"
            >
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
          }
        </div>
        } @else {
        <p class="empty-category-text">No albums in this category yet.</p>
        }
      </section>
      } } @else if (!isLoading()) {
      <div class="empty-state">
        <mat-icon>album</mat-icon>
        <p>No albums found in your library.</p>
      </div>
      }
    </mat-tab>

    <mat-tab label="Artists">
      @if (artists().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">
          @if (status === 'love') { <mat-icon>favorite</mat-icon> } @else if (status === 'explore')
          { <mat-icon>explore</mat-icon> } @else { <mat-icon>check_circle</mat-icon> }
          {{ statusTitles[status] }}
        </h2>
        @let filteredArtists = getItemsByStatus(artists(), status); @if (filteredArtists.length > 0)
        {
        <div class="simple-grid">
          @for (item of filteredArtists; track item._id) {
          <div class="grid-item" [routerLink]="['/details', item.itemType, item.spotifyItemId]">
            <img [src]="item.metadata.imageUrl || ''" class="artist-img" alt="Artist photo" />
            <div class="grid-info">
              <p class="artist-name">{{ item.metadata.name }}</p>
            </div>
            <button
              mat-icon-button
              (click)="deleteItem(item._id); $event.stopPropagation()"
              [aria-label]="'Delete ' + item.metadata.name + ' from library'"
              type="button"
              class="delete-button"
            >
              <mat-icon>delete_outline</mat-icon>
            </button>
          </div>
          }
        </div>
        } @else {
        <p class="empty-category-text">No artists in this category yet.</p>
        }
      </section>
      } } @else if (!isLoading()) {
      <div class="empty-state">
        <mat-icon>person</mat-icon>
        <p>No artists found in your library.</p>
      </div>
      }
    </mat-tab>
  </mat-tab-group>

  @if (isLoading()) {
  <app-loading></app-loading>
  }
</div>
