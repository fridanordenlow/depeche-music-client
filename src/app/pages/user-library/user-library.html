<div class="library-container">
  @if (currentUser(); as user) {
  <div class="user-greeting">
    <h2>Welcome, {{ user.username }}!</h2>
    <p>
      See your collection of artist, albums and tracks below. Continue building your library by
      exploring new releases, user recommendations and search for music.
    </p>
  </div>
  }

  <h1 class="library-header">My Library</h1>
  <mat-tab-group animationDuration="0ms">
    <mat-tab label="Tracks ">
      @if (tracks().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">{{ statusTitles[status] }}</h2>
        <mat-action-list>
          @for (item of tracks(); track item._id) { @if (item.status === status) {
          <mat-list-item>
            <img matListItemAvatar [src]="item.metadata.imageUrl" alt="Album cover for track" />
            <span matListItemTitle>{{ item.metadata.title }}</span>
            <span matListItemLine>{{ item.metadata.artists?.[0]?.name }}</span>
            <div matListItemMeta>
              <button
                mat-icon-button
                (click)="deleteItem(item._id)"
                [aria-label]="'Delete ' + item.metadata.title + ' from library'"
                type="button"
              >
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </mat-list-item>
          <mat-divider></mat-divider>
          } }
        </mat-action-list>
      </section>
      } } @else if (!libraryResource.isLoading()) {
      <div class="empty-state">
        <mat-icon>music_off</mat-icon>
        <p>No tracks found in your library.</p>
      </div>
      }
    </mat-tab>

    <mat-tab label="Albums">
      @if (albums().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">{{ statusTitles[status] }}</h2>
        <div class="simple-grid">
          @for (item of albums(); track item._id) { @if (item.status === status) {
          <div class="grid-item">
            <img [src]="item.metadata.imageUrl" />
            <div class="grid-info">
              <p class="album-title">{{ item.metadata.title }}</p>
              <p class="album-artist">{{ item.metadata.artists?.[0]?.name }}</p>
              <button mat-button color="warn" (click)="deleteItem(item._id)">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>
          } }
        </div>
      </section>
      } } @else if (!libraryResource.isLoading()) {
      <div class="empty-state">
        <mat-icon>album</mat-icon>
        <p>No albums found in your library.</p>
      </div>
      }
    </mat-tab>

    <mat-tab label="Artists">
      @if (artists().length > 0) { @for (status of ['love', 'explore', 'listened']; track status) {
      <section>
        <h2 class="status-header">{{ statusTitles[status] }}</h2>
        <div class="simple-grid">
          @for (item of artists(); track item._id) { @if (item.status === status) {
          <div class="grid-item">
            <img [src]="item.metadata.imageUrl" class="artist-img" />
            <div class="grid-info">
              <strong>{{ item.metadata.name }}</strong>
              <button mat-button color="warn" (click)="deleteItem(item._id)">
                <mat-icon>delete_outline</mat-icon>
              </button>
            </div>
          </div>
          } }
        </div>
      </section>
      } } @else if (!libraryResource.isLoading()) {
      <div class="empty-state">
        <mat-icon>person</mat-icon>
        <p>No artists found in your library.</p>
      </div>
      }
    </mat-tab>
  </mat-tab-group>

  @if (libraryResource.isLoading()) {
  <div>
    <mat-spinner diameter="50"></mat-spinner>
  </div>
  }
</div>
